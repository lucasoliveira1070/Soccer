<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Soccers API</title>
	<script src="js/jquery-3.6.0.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/fileSaver.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
		integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
	<script type="text/javascript">

		const EXCEL_TYPE = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';
		const EXCEL_EXTENSION = '.xlxs';
		var jsonresult;

		$(function () {
			$("#consultar").click(function () {
				var puser = $('#user').val();
				var ptoken = $('#token').val();
				var resultado;
				var url = "https://api.soccersapi.com/v2.2/leagues/?user=" + puser + "&token=" + ptoken + "&t=list";
				$.ajax
					({
						url: url,
						type: 'GET',
						dataType: 'json',
						success: function (data) {
							resultado = JSON.stringify(data, undefined, 1);
							document.getElementById("json-area").value = resultado;
							document.getElementById("json-area").readOnly = true;
							jsonresult = resultado;

						}
					});
			}

			);
		});

		function downloadAsExcel() {
			const worksheet = XLSX.utils.json_to_sheet([jsonresult]);
			const workbook = {
				Sheets: {
					'jsonresult': worksheet
				},
				SheetNames: ['Match ID']
			};
			const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
			saveAsExcel(excelBuffer, 'Match ID');


		};

		function saveAsExcel(buffer, filename) {
			const data = new Blob([buffer], { type: EXCEL_TYPE });
			saveAs(data, filename + EXCEL_EXTENSION);
		};
	</script>
</head>

<body>
	<form name="frmparams" method="post" action="">
		<div class="form-group">
			<label>User</label>
			<input type="text" name="txtuser" id="user" value="loliveira306"><br>
		</div>
		<div class="form-group">
			<label>Token</label>
			<input type="text" name="txttoken" id="token"><br>
		</div>
	</form>

	<button class="button" name="gerarexcel" id="consultar">Consultar</button>
	<button type="button" id="downloadExcel" onclick="downloadAsExcel()">Converter</button>
	<pre id="jsonData"></pre>
	<h2>Json</h2>

	<textarea rows="20" cols="100" id="json-area">

</textarea>
</body>

</html>